"use strict";(self.webpackChunkkerbal_transfer_illustrator=self.webpackChunkkerbal_transfer_illustrator||[]).push([[315],{6939:function(t,i,s){var e=s(2982),n=s(5671),o=s(3144),r=s(8818),h=s(8034),a=s(5570),c=s(724),u=s(4067),d=function(){function t(i){var s=this;if((0,n.Z)(this,t),this._system=void 0,this._sequenceUp=void 0,this._sequenceDown=void 0,this._startOrbit=void 0,this._endOrbit=void 0,this._startBody=void 0,this._endBody=void 0,this._transferBody=void 0,this._startDate=void 0,this._flightTime=void 0,this._endDate=void 0,this._transferTrajectory=void 0,this._ejections=void 0,this._insertions=void 0,this._soiPatchPositions=void 0,this._soiPatchBodies=void 0,this._ejectionInsertionType=void 0,this._planeChange=void 0,this._noInsertionBurn=void 0,this._matchStartMo=void 0,this._matchEndMo=void 0,this._maneuvers=void 0,this._maneuverContexts=void 0,this._deltaV=void 0,this._system=i.system,this._startOrbit=i.startOrbit,this._startBody=i.startBody?i.startBody:this.bodyFromId(this._startOrbit.orbiting),this._endOrbit=i.endOrbit,this._endBody=i.endBody?i.endBody:this.bodyFromId(this._endOrbit.orbiting),this._startDate=i.startDate,this._flightTime=i.flightTime,this._endDate=i.startDate+i.flightTime,i.transferBody)this._transferBody=i.transferBody;else{var o=this._startBody.id,r=this._endBody.id,h=this.commonAttractorId(o,r);this._transferBody=this.bodyFromId(h)}i.sequenceUp?this._sequenceUp=i.sequenceUp:this.setSequenceUp(),i.sequenceDown?this._sequenceDown=i.sequenceDown:this.setSequenceDown();var a=[].concat((0,e.Z)(this._sequenceUp.slice(0,this._sequenceUp.length-1)),(0,e.Z)(this._sequenceDown.slice(1,this._sequenceDown.length)));if(this._soiPatchBodies=a.map((function(t){return s.bodyFromId(t)})),this._ejectionInsertionType=void 0===i.ejectionInsertionType?"fastdirect":i.ejectionInsertionType,this._planeChange=void 0!==i.planeChange&&i.planeChange,this._matchStartMo=void 0===i.matchStartMo||i.matchStartMo,this._matchEndMo=void 0!==i.matchEndMo&&i.matchEndMo,this._noInsertionBurn=void 0!==i.noInsertionBurn&&i.noInsertionBurn,this._transferTrajectory={orbits:[],intersectTimes:[],maneuvers:[]},this._ejections=[],this._insertions=[],this._maneuvers=[],this._maneuverContexts=[],i.soiPatchPositions)this._soiPatchPositions=i.soiPatchPositions;else{this._soiPatchPositions=[];for(var u=1;u<=this._soiPatchBodies.length;u++)this._soiPatchPositions.push((0,c.R3)(0,0,0))}this.computeTransfer()}return(0,o.Z)(t,[{key:"deltaV",get:function(){return this._deltaV}},{key:"ejectionDeltaV",get:function(){return this._maneuvers[0].deltaV}},{key:"insertion",get:function(){return this._maneuvers[this._maneuvers.length].deltaV}},{key:"data",get:function(){return{system:this._system,startOrbit:this._startOrbit,endOrbit:this._endOrbit,startDate:this._startDate,flightTime:this._flightTime,endDate:this._endDate,transferTrajectory:this._transferTrajectory,ejections:this._ejections,insertions:this._insertions,maneuvers:this._maneuvers,maneuverContexts:this._maneuverContexts,deltaV:this._deltaV,soiPatchPositions:this._soiPatchPositions,ejectionInsertionType:this._ejectionInsertionType,planeChange:this._planeChange,matchStartMo:this._matchStartMo,matchEndMo:this._matchEndMo,noInsertionBurn:this._noInsertionBurn,patchPositionError:this.soiPatchPositionError(),patchTimeError:this.soiPatchTimeError()}}},{key:"transfer",get:function(){return new a.Z(this.data)}},{key:"clearOrbits",value:function(){this._transferTrajectory={orbits:[],intersectTimes:[],maneuvers:[]},this._ejections=[],this._insertions=[],this._maneuvers=[],this._maneuverContexts=[]}},{key:"computeTransfer",value:function(){this.clearOrbits(),this.setTransferOrbit(),this.setEjectionOrbits(),this.setInsertionOrbits(),this.setManeuvers(),this.setDeltaV()}},{key:"bodyFromId",value:function(t){if(0===t)return this._system.sun;var i=this._system.orbiterIds.get(t);if(!i)throw new Error("No body with id ".concat(t));return i}},{key:"sequenceToSun",value:function(t){for(var i=this.bodyFromId(t),s=[i.id];i.hasOwnProperty("orbiting");)i=this.bodyFromId(i.orbiting),s.push(i.id);return s}},{key:"commonAttractorId",value:function(t,i){for(var s=this.sequenceToSun(t),e=this.sequenceToSun(i),n=0;n<s.length;n++)if(e.includes(s[n]))return s[n];throw new Error("Bodies do not share a common attractor (error in defining this SolarSystem)")}},{key:"setSequenceUp",value:function(){for(var t=this._startBody,i=[this._startBody.id];t.id!==this._transferBody.id;){if(!t.hasOwnProperty("orbiting"))throw new Error("The start body does not orbit around the transfer body");t=this.bodyFromId(t.orbiting),i.push(t.id)}this._sequenceUp=i}},{key:"setSequenceDown",value:function(){for(var t=this._endBody,i=[this._endBody.id];t.id!==this._transferBody.id;){if(!t.hasOwnProperty("orbiting"))throw new Error("The end body does not orbit around the transfer body");t=this.bodyFromId(t.orbiting),i.push(t.id)}this._sequenceDown=i.reverse()}},{key:"setTransferOrbit",value:function(){var t=1===this._sequenceUp.length?this._startOrbit:this.bodyFromId(this._sequenceUp[this._sequenceUp.length-2]).orbit,i=this._sequenceUp.length-2,s=i>=0?this._soiPatchPositions[i]:(0,c.R3)(0,0,0),e=1===this._sequenceDown.length?this._endOrbit:this.bodyFromId(this._sequenceDown[1]).orbit,n=i+1,o=n<=this._soiPatchPositions.length?this._soiPatchPositions[n]:(0,c.R3)(0,0,0);this._transferTrajectory=h.Z.transferTrajectory(t,e,this._transferBody,this._startDate,this._flightTime,this._endDate,this._planeChange,s,o)}},{key:"setEjectionOrbits",value:function(){var t=this._sequenceUp.length-1;this._ejections=h.Z.ejectionTrajectories(this._system,this._startOrbit,this._transferTrajectory.orbits[0],this._sequenceUp,this._startDate,this._matchStartMo,this._ejectionInsertionType,this._soiPatchPositions.slice(0,t))}},{key:"setInsertionOrbits",value:function(){var t=this._sequenceUp.length-1,i=this._transferTrajectory.orbits.length;this._insertions=h.Z.insertionTrajectories(this._system,this._endOrbit,this._transferTrajectory.orbits[i-1],this._sequenceDown,this._endDate,this._matchEndMo,this._ejectionInsertionType,this._soiPatchPositions.slice(t))}},{key:"setManeuvers",value:function(){if(this._maneuvers=[],this._maneuverContexts=[],this._ejections.length>0)for(var t=0;t<this._ejections.length;t++)if(0===t){for(var i,s,n=this._ejections[t].maneuvers,o=this.bodyFromId(this._ejections[t].orbits[0].orbiting).name,r=["Departure Burn"],h=0;h<n.length-1;h++)r.push("Oberth Maneuver Burn over "+o);(i=this._maneuvers).push.apply(i,(0,e.Z)(n)),(s=this._maneuverContexts).push.apply(s,r)}else{for(var a,c,u=this._ejections[t].maneuvers.slice(1),d=this.bodyFromId(this._ejections[t].orbits[0].orbiting).name,_=[],m=0;m<u.length;m++)_.push("Oberth Maneuver Burn over "+d);(a=this._maneuvers).push.apply(a,(0,e.Z)(u)),(c=this._maneuverContexts).push.apply(c,_)}else this._maneuvers.push(this._transferTrajectory.maneuvers[0]),this._maneuverContexts.push("Departure Burn");if(this._transferTrajectory.maneuvers.length>2){var l,v,y=this._transferTrajectory.maneuvers.slice(1,-1),f=y.map((function(t){return"Plane Change Burn"}));(l=this._maneuvers).push.apply(l,(0,e.Z)(y)),(v=this._maneuverContexts).push.apply(v,(0,e.Z)(f))}if(this._insertions.length>0)for(var p=0;p<this._insertions.length;p++)if(p===this._insertions.length-1){for(var P,g,b=this._insertions[p].maneuvers,T=this.bodyFromId(this._insertions[p].orbits[0].orbiting).name,j=["Arrival Burn"],I=0;I<b.length-1;I++)j.push("Oberth Maneuver Burn over "+T);(P=this._maneuvers).push.apply(P,(0,e.Z)(b)),(g=this._maneuverContexts).push.apply(g,j)}else{for(var O,D,B=this._insertions[p].maneuvers.slice(0,-1),E=this.bodyFromId(this._insertions[p].orbits[0].orbiting).name,M=[],k=0;k<B.length;k++)M.push("Oberth Maneuver Burn over "+E);(O=this._maneuvers).push.apply(O,(0,e.Z)(B)),(D=this._maneuverContexts).push.apply(D,M)}else{var S=this._transferTrajectory.maneuvers.length;this._maneuvers.push(this._transferTrajectory.maneuvers[S-1]),this._maneuverContexts.push("Arrival Burn")}}},{key:"setDeltaV",value:function(){for(var t=0,i=0;i<this._maneuvers.length;i++)t+=this._maneuvers[i].deltaVMag;isNaN(t)&&(t=Number.MAX_VALUE),this._deltaV=t}},{key:"calculateSoiPatches",value:function(){for(var t=[],i=0;i<this._ejections.length;i++){var s=this._ejections[i].orbits.length,e=this._ejections[i].orbits[s-1],n=this._ejections[i].intersectTimes[s];t.push(r.Z.orbitToPositionAtDate(e,n))}for(var o=0;o<this._insertions.length;o++){var h=this._insertions[o].orbits[0],a=this._insertions[o].intersectTimes[0];t.push(r.Z.orbitToPositionAtDate(h,a))}return t}},{key:"setSoiPatchPositions",value:function(){this._soiPatchPositions=this.calculateSoiPatches()}},{key:"soiPatchPositionError",value:function(){for(var t=this.calculateSoiPatches(),i=0,s=0;s<this._soiPatchPositions.length;s++)i+=(0,c.G7)((0,c.qK)(this._soiPatchPositions[s],t[s]));return i}},{key:"soiPatchUpTimeErrors",value:function(){for(var t=[],i=this._ejections.length-1,s=0;s<=i;s++){var e=this._ejections[s].orbits.length;s===i?t.push(this._ejections[s].intersectTimes[e]-this._startDate):t.push(this._ejections[s].intersectTimes[e]-this._ejections[s+1].orbits[0].epoch)}return t}},{key:"soiPatchDownTimeErrors",value:function(){for(var t=[],i=0;i<this._insertions.length;i++)if(0===i)t.push(this._insertions[i].intersectTimes[0]-this._endDate);else{var s=this._insertions[i-1].orbits.length;t.push(this._insertions[i].intersectTimes[0]-this._insertions[i-1].intersectTimes[s])}return t}},{key:"soiPatchTimeError",value:function(){for(var t=0,i=this.soiPatchUpTimeErrors(),s=0;s<i.length;s++)t+=Math.abs(i[s]);for(var e=this.soiPatchDownTimeErrors(),n=0;n<e.length;n++)t+=Math.abs(e[n]);return t}},{key:"patchPositionsToAngles",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._soiPatchPositions,i=[],s=0;s<t.length;s++){var e=(0,c.jE)(t[s]);i.push(e.theta,e.phi)}return i}},{key:"setPatchPositionsFromAngles",value:function(t){for(var i=0;i<this._soiPatchBodies.length;i++)this._soiPatchPositions[i]=(0,c.io)({r:this._soiPatchBodies[i].soi,theta:t[2*i],phi:t[2*i+1]})}},{key:"optimizeSoiPatchPositions",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100*this._soiPatchPositions.length;if(console.log("\tOptimizing transfer SoI patch positions only."),0!==this._soiPatchPositions.length){0===(0,c.G7)(this._soiPatchPositions[0])&&this.setSoiPatchPositions();for(var e=function(i){return t.setPatchPositionsFromAngles(i),t.computeTransfer(),t.soiPatchPositionError()+1e3*t._deltaV},n=[this.patchPositionsToAngles()],o=0;o<this._soiPatchBodies.length;o++){var r=n[0].slice(),h=n[0].slice();r[2*o]+=(0,c.EO)()*(Math.random()*Math.PI/24),h[2*o+1]+=(0,c.EO)()*(Math.random()*Math.PI/12),n.push(r),n.push(h)}var a=(0,u.c4)(n,e,i,s);this.setPatchPositionsFromAngles(a),this.computeTransfer()}}},{key:"initialPositionAndAnglePoints",value:function(){for(var t=[[this._startDate,this._flightTime].concat((0,e.Z)(this.patchPositionsToAngles())),[this._startDate+(0,c.EO)()*Math.random()*this._transferTrajectory.orbits[0].siderealPeriod/4,this._flightTime].concat((0,e.Z)(this.patchPositionsToAngles())),[this._startDate,this._flightTime+(0,c.EO)()*Math.random()*this._transferTrajectory.orbits[0].siderealPeriod/4].concat((0,e.Z)(this.patchPositionsToAngles()))],i=1;i<=this._soiPatchBodies.length;i++){var s=t[0].slice(),n=t[0].slice();s[2*i]+=(0,c.EO)()*(Math.random()*Math.PI/24),n[2*i+1]+=(0,c.EO)()*(Math.random()*Math.PI/12),t.push(s),t.push(n)}return t}},{key:"optimizeSoiPatchPositionsAndTimes",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100*(this._soiPatchPositions.length+2);if(console.log("\tOptimizing transfer SoI patch positions and times."),0!==this._soiPatchPositions.length){0===(0,c.G7)(this._soiPatchPositions[0])&&this.setSoiPatchPositions();var e=function(i){return t._startDate=i[0],t._flightTime=i[1],t._endDate=i[0]+i[1],t.setPatchPositionsFromAngles(i.slice(2,i.length)),t.computeTransfer(),t.soiPatchPositionError()+10*t.soiPatchTimeError()+100*t._deltaV},n=this.initialPositionAndAnglePoints(),o=(0,u.c4)(n,e,i,s);e(o)}}},{key:"optimizeSoiPatches",value:function(){0===this._soiPatchPositions.length?console.log("\tThere are no SoI patches to optimize."):0!==this._ejections.length&&(1!==this._ejections.length||this._matchStartMo)||0!==this._insertions.length&&(1!==this._insertions.length||this._matchEndMo)?this.optimizeSoiPatchPositionsAndTimes():this.optimizeSoiPatchPositions()}}]),t}();i.Z=d},5570:function(t,i,s){var e=s(5671),n=s(3144),o=s(4940),r=s(7487),h=s(6939),a=s(8818),c=s(724),u=function(){function t(i){(0,e.Z)(this,t),this.system=void 0,this.startOrbit=void 0,this.endOrbit=void 0,this.startDate=void 0,this.flightTime=void 0,this.endDate=void 0,this.transferTrajectory=void 0,this.ejections=void 0,this.insertions=void 0,this.maneuvers=void 0,this.maneuverContexts=void 0,this.deltaV=void 0,this.soiPatchPositions=void 0,this.ejectionInsertionType=void 0,this.planeChange=void 0,this.noInsertionBurn=void 0,this.matchStartMo=void 0,this.matchEndMo=void 0,this.patchPositionError=void 0,this.patchTimeError=void 0,this.system=new o.Z(i.system.sun,i.system.orbiters),this.startOrbit=new r.Z(i.startOrbit,this.system.bodyFromId(i.startOrbit.orbiting)),this.endOrbit=new r.Z(i.endOrbit,this.system.bodyFromId(i.endOrbit.orbiting)),this.startDate=i.startDate,this.flightTime=i.flightTime,i.endDate?this.endDate=i.endDate:this.endDate=i.startDate+i.flightTime,this.transferTrajectory=i.transferTrajectory,this.ejections=i.ejections,this.insertions=i.insertions,this.maneuvers=i.maneuvers,this.maneuverContexts=i.maneuverContexts,this.deltaV=i.deltaV,this.ejectionInsertionType=i.ejectionInsertionType,this.planeChange=i.planeChange,this.matchStartMo=i.matchStartMo,this.matchEndMo=i.matchEndMo,this.noInsertionBurn=i.noInsertionBurn,this.soiPatchPositions=i.soiPatchPositions,this.patchPositionError=i.patchPositionError,this.patchTimeError=i.patchTimeError}return(0,n.Z)(t,[{key:"data",get:function(){return{system:this.system,startOrbit:this.startOrbit,endOrbit:this.endOrbit,startDate:this.startDate,flightTime:this.flightTime,endDate:this.endDate,transferTrajectory:this.transferTrajectory,ejections:this.ejections,insertions:this.insertions,maneuvers:this.maneuvers,maneuverContexts:this.maneuverContexts,deltaV:this.deltaV,soiPatchPositions:this.soiPatchPositions,ejectionInsertionType:this.ejectionInsertionType,planeChange:this.planeChange,matchStartMo:this.matchStartMo,matchEndMo:this.matchEndMo,noInsertionBurn:this.noInsertionBurn,patchPositionError:this.patchPositionError,patchTimeError:this.patchTimeError}}},{key:"optimizeSoiPatches",value:function(){var t={system:this.system,startOrbit:this.startOrbit,endOrbit:this.endOrbit,startDate:this.startDate,flightTime:this.flightTime,soiPatchPositions:this.soiPatchPositions,planeChange:this.planeChange,matchStartMo:this.matchStartMo,matchEndMo:this.matchEndMo,noInsertionBurn:this.noInsertionBurn},i=new h.Z(t);return i.optimizeSoiPatches(),i.transfer}},{key:"transferBody",get:function(){return this.system.bodyFromId(this.system.commonAttractorId(this.startOrbit.orbiting,this.endOrbit.orbiting))}},{key:"startBody",get:function(){return this.system.bodyFromId(this.startOrbit.orbiting)}},{key:"endBody",get:function(){return this.system.bodyFromId(this.endOrbit.orbiting)}},{key:"phaseAngle",get:function(){var t=0===this.ejections.length?this.startOrbit:this.system.bodyFromId(this.ejections[this.ejections.length-1].orbits[0].orbiting).orbit,i=0===this.insertions.length?this.endOrbit:this.system.bodyFromId(this.insertions[0].orbits[0].orbiting).orbit,s=a.Z.orbitToPositionAtDate(t,this.startDate),e=a.Z.orbitToPositionAtDate(i,this.startDate),n=a.Z.angleInOrbitPlane(s,t),o=a.Z.angleInOrbitPlane(e,t);return(0,c.z7)(o-n)}}]),t}();i.Z=u}}]);
//# sourceMappingURL=315.f1633ae0.chunk.js.map